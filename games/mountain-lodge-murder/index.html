<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>산장의 비밀</title>
  <link rel="stylesheet" href="https://unpkg.com/monogatari/dist/engine/core.css">
  <style>
    body { margin: 0; padding: 0; background: #000; color: #fff; }
    #game-screen { width: 100vw; height: 100vh; }
    #debug-log { position: fixed; top: 10px; left: 10px; font-size: 11px; color: #0f0; background: rgba(0,0,0,0.8); z-index: 9999; }
  </style>
</head>
<body>
  <div id="debug-log">검사 중...</div>
  <div id="game-screen">
    <visual-novel></visual-novel>
  </div>

  <script src="https://unpkg.com/monogatari@2.0.0-beta.21/dist/engine/core.js"></script>
  
  <script src="js/script.js"></script>

  <script>
    const log = (msg) => { document.getElementById('debug-log').innerText += "\n" + msg; console.log(msg); };

    window.addEventListener('load', () => {
      log("페이지 로딩 완료");

      // [핵심] Monogatari 객체 구조를 샅샅이 뒤져서 init을 찾아냅니다.
      let engine = null;

      if (window.monogatari) {
        engine = window.monogatari; // 소문자 인스턴스
        log("소문자 monogatari 발견");
      } else if (window.Monogatari) {
        // 대문자일 경우, 인스턴스인지 클래스인지 확인
        if (typeof window.Monogatari.init === 'function') {
          engine = window.Monogatari;
          log("대문자 Monogatari 객체 발견");
        } else if (window.Monogatari.monogatari) {
          engine = window.Monogatari.monogatari;
          log("Monogatari.monogatari 하위 객체 발견");
        }
      }

      if (engine && typeof engine.init === 'function') {
        engine.init('#game-screen').then(() => {
          log("✅ 성공: 게임 초기화 완료!");
          setTimeout(() => document.getElementById('debug-log').style.display = 'none', 1000);
        });
      } else {
        log("❌ 에러: 적절한 엔진 인스턴스를 찾을 수 없습니다.");
        // 엔지니어를 위한 객체 구조 덤프
        console.dir(window.Monogatari || window.monogatari);
      }
    });
  </script>
</body>
</html>